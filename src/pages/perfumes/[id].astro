---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import WhatsAppButton from '../../components/WhatsAppButton.astro';
import FragrancePreview from '../../components/FragrancePreview.astro';
import { fragrances, getFragranceById } from '../../data/fragrances';

export async function getStaticPaths() {
  return fragrances.map((f) => ({ params: { id: f.id } }));
}

const { id } = Astro.params;
const fragrance = getFragranceById(id || '');
if (!fragrance) {
  return Astro.redirect('/fragancias');
}

// Capturar el filtro de la URL si existe
const url = new URL(Astro.request.url);
const filter = url.searchParams.get('filter');
---

<Layout title={`${fragrance.displayName} - DAR Casa de la PerfumerÃ­a`} description={fragrance.description}>
  <Header />
  <WhatsAppButton />
  <main>
    <FragrancePreview fragrance={fragrance} currentFilter={filter} />
  </main>
  <Footer />
</Layout>